{"version":3,"sources":["webpack:///C:/Users/huzean/Desktop/qihuocc/components/hch-poster/hch-poster.vue?c8a1","webpack:///C:/Users/huzean/Desktop/qihuocc/components/hch-poster/hch-poster.vue?97be","webpack:///C:/Users/huzean/Desktop/qihuocc/components/hch-poster/hch-poster.vue?60a2","webpack:///C:/Users/huzean/Desktop/qihuocc/components/hch-poster/hch-poster.vue?08ed","uni-app:///components/hch-poster/hch-poster.vue","webpack:///C:/Users/huzean/Desktop/qihuocc/components/hch-poster/hch-poster.vue?9acc","webpack:///C:/Users/huzean/Desktop/qihuocc/components/hch-poster/hch-poster.vue?e930"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuH;AACvH;AAC8D;AACL;AACc;;;AAGvE;AAC6K;AAC7K,gBAAgB,uLAAU;AAC1B,EAAE,gFAAM;AACR,EAAE,qFAAM;AACR,EAAE,8FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,yFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAypB,CAAgB,sqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;ACa7qB;AACA,MADA,kBACA;AACA;;;AAGA,GALA;AAMA;AACA;AACA,mBADA;AAEA,mBAFA,EADA;;AAKA;AACA,kBADA;AAEA;AACA,eADA,EACA;AACA,mEAFA,EAEA;AACA,iBAHA,EAGA;AACA,yBAJA,EAIA;AACA,sBALA,EAKA;AACA,oEANA,CAMA;AANA,OAFA,EALA,EANA;;;AAuBA;AACA;AACA;AACA,aAHA,qBAGA,GAHA,EAGA,CAHA,EAGA,CAHA,EAGA,CAHA,EAGA,CAHA,EAGA,CAHA,EAGA,SAHA,EAGA,WAHA,EAGA,GAHA,EAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,yDADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARA,MAQA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAvDA;;AAyDA;;;;;;;AAOA,uBAhEA,+BAgEA,GAhEA,EAgEA,IAhEA,EAgEA,YAhEA,EAgEA,UAhEA,EAgEA;AACA,qCADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA,cADA,CACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA,yBAZA,CAYA;AACA;AACA;AACA;AACA;AACA;AACA,KAlGA;AAmGA;AACA,WApGA,qBAoGA;AACA;AACA;AACA,uBADA;AAEA,6CAFA;AAGA;AACA,+DADA,EAHA;;AAMA;AACA,sDADA;AAEA,4CAFA;AAGA,wCAHA;AAIA,0BAJA,EANA;;AAYA,YAZA,CAYA;AACA;AACA;AACA;AACA;AACA;AACA,gCADA;AAEA,iCAFA;AAGA,gCAHA;AAIA,qBAJA,qBAIA;AACA;AACA,eANA;AAOA,kBAPA,kBAOA;AACA;AACA;AACA,iCADA;AAEA,gCAFA;AAGA,8BAHA;;AAKA,eAdA;;AAgBA,WApBA,MAoBA;AACA;AACA,qCADA;AAEA,0BAFA;AAGA,4BAHA;AAIA,kBAJA;;AAMA;AACA,SAzCA,EAyCA,KAzCA,CAyCA;AACA;AACA;AACA,2BADA;AAEA,0BAFA;AAGA,wBAHA;;AAKA,SAhDA;AAiDA,OAlDA;AAmDA,KAxJA;;AA0JA;AACA,qBA3JA,+BA2JA;AACA;AACA;AACA;AACA;AACA;AACA,yBADA;;AAGA;AACA;AACA;AACA;AACA,qCAZA,CAYA;AACA,qCAbA,CAaA;AACA;AACA;AACA,mCAhBA,CAgBA;AACA,4CAjBA,CAiBA;AACA;AACA;AACA;AACA;;AAEA,iBAvBA,CAuBA;AACA;AACA,6FAzBA,CAyBA;AACA,oBA1BA,CA0BA;AACA;AACA,8FA5BA,CA4BA;AACA;AACA;AACA;AACA,gBADA;AAEA,eAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BADA,EACA,YADA,EACA,EADA;AAEA,mBAFA,EAEA,SAFA,EANA,CAQA;AACA,wHATA,CASA;AACA,wBAVA,CAUA;AACA;AACA,SAdA;AAeA,YAfA,kBAeA;AACA;AACA;AACA,2BADA;AAEA,0BAFA;AAGA,wBAHA;;AAKA,SAtBA;;AAwBA;AACA;AACA,qBADA;AAEA,eAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA,SALA;AAMA,YANA,kBAMA;AACA;AACA;AACA,2BADA;AAEA,0BAFA;AAGA,wBAHA;;AAKA,SAbA;;AAeA;AACA;AACA;AACA,8BADA,CACA;AACA,oCAFA,CAEA;AACA,4BAHA,CAGA;AACA;AACA;AACA,gFANA,CAMA;AACA,+BAPA,CAOA;AACA,2BARA,CAQA;AACA,gCATA,CASA;AACA;AACA;AACA;AACA;AACA,OAdA,EAcA,GAdA;AAeA;AACA;AACA;AACA,wBADA;AAEA,eAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA,SALA;AAMA,YANA,kBAMA;AACA;AACA;AACA,2BADA;AAEA,0BAFA;AAGA,wBAHA;;AAKA,SAbA;;AAeA;AACA;AACA,0BA3GA,CA2GA;AACA,kCA5GA,CA4GA;AACA;AACA;AACA,0BA/GA,CA+GA;AACA,iDAhHA,CAgHA;AACA,iDAjHA,CAiHA;;AAEA,oDAnHA,CAmHA;AACA;;AAEA,sBAtHA,CAsHA;AACA,0BAvHA,CAuHA;AACA,+BAxHA,CAwHA;AACA,0DAzHA,CAyHA;AACA,+FA1HA,CA0HA;AACA,mDA3HA,CA2HA;AACA,iEA5HA,CA4HA;AACA;AACA,mBA9HA,CA8HA;AACA,sBA/HA,CA+HA;AACA;AACA;AACA;AACA;AACA,iBADA;AAEA,eAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA,SALA;AAMA,YANA,kBAMA;AACA;AACA;AACA,2BADA;AAEA,0BAFA;AAGA,wBAHA;;;AAMA,SAdA;;AAgBA;;AAEA;AACA;AACA;AACA,kCAxJA,CAwJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAvKA,CAuKA;AACA;AACA;AACA;AACA;AACA,KAvUA;;AAyUA;AACA,mBA1UA,6BA0UA;AACA;AACA;AACA,uBADA;;AAGA;AACA;AACA;AACA,aADA;AAEA,aAFA;AAGA,gCAHA,EAGA;AACA,iCAJA,EAIA;AACA,0CALA;AAMA,2CANA;AAOA,4BAPA;AAQA,eARA,mBAQA,GARA,EAQA;AACA;AACA;AACA,sCADA;AAEA,mBAFA,mBAEA,IAFA,EAEA;AACA;AACA;AACA,uCADA;AAEA,8BAFA;;AAIA;AACA,aATA;AAUA,gBAVA,kBAUA;AACA;AACA,kCADA;AAEA,8BAFA;AAGA,4BAHA;;AAKA;AACA,aAjBA;;AAmBA,SA7BA;AA8BA,YA9BA,kBA8BA;AACA;AACA,8BADA;AAEA,0BAFA;AAGA,wBAHA;;AAKA;AACA,SArCA;;AAuCA,KAxXA;AAyXA;AACA,mBA1XA,6BA0XA;AACA;AACA;AACA,KA7XA,EAvBA,E;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAssC,CAAgB,wpCAAG,EAAC,C;;;;;;;;;;;ACA1tC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/hch-poster/hch-poster.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./hch-poster.vue?vue&type=template&id=308841a4&\"\nvar renderjs\nimport script from \"./hch-poster.vue?vue&type=script&lang=js&\"\nexport * from \"./hch-poster.vue?vue&type=script&lang=js&\"\nimport style0 from \"./hch-poster.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/hch-poster/hch-poster.vue\"\nexport default component.exports","export * from \"-!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./hch-poster.vue?vue&type=template&id=308841a4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./hch-poster.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./hch-poster.vue?vue&type=script&lang=js&\"","<template>\n\t<!-- 海报(想让海报显示隐藏要用hidden，v-if关闭后没办法在完整的出来海报) 保存海报按钮和关闭按钮 在html代码中写出来 绑定点击方法然后透明 再用canvas 覆盖 -->\n\t<view class=\"canvas_box\" :hidden=\"canvasFlag\">\n\t\t<view class=\"canvas_box_mask\"></view><!-- 遮罩 -->\n\t\t<icon type=\"cancel\" class=\"canvas_close_btn\" size=\"60\" @tap=\"canvasCancelEvn\" color=\"transparent\" /><!-- 关闭 -->\n\t\t<view class=\"button-wrapper\">\n\t\t\t<!-- 保存海报按钮 -->\n\t\t\t<cover-view class=\"save_btn\" @tap=\"saveCanvasImage\"></cover-view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\n\t\t\t}\n\t\t},\n\t\tprops: {\n\t\t\tcanvasFlag: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true,\n\t\t\t},\n\t\t\tposterObj: {\n\t\t\t\ttype: Object,\n\t\t\t\tdefault: {\n\t\t\t\t\turl: '', //商品主图\n\t\t\t\t\ticon: 'https://img0.zuipin.cn/mp_zuipin/poster/hch-hyj.png', //会员价图标\n\t\t\t\t\ttitle: \"\", //标题\n\t\t\t\t\tdiscountPrice: \"\", //折后价格\n\t\t\t\t\torignPrice: \"\", //原价\n\t\t\t\t\tcode: 'https://img0.zuipin.cn/mp_zuipin/poster/hch-code.png', //小程序码\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\t// 海报\n\t\t\t// 画圆角矩形 ctx、x起点、y起点、w宽度、h高度、r圆角半径、fillColor填充颜色、strokeColor边框颜色\n\t\t\troundRect(ctx, x, y, w, h, r, fillColor, strokeColor, btn) {\n\t\t\t\t// 开始绘制\n\t\t\t\tctx.beginPath()\n\t\t\t\t// 绘制左上角圆弧 Math.PI = 180度\n\t\t\t\t// 圆心x起点、圆心y起点、半径、以3点钟方向顺时针旋转后确认的起始弧度、以3点钟方向顺时针旋转后确认的终止弧度\n\t\t\t\tctx.arc(x + r, y + r, r, Math.PI, Math.PI * 1.5)\n\t\t\t\t// 绘制border-top\n\t\t\t\t// 移动起点位置 x终点、y终点\n\t\t\t\tctx.moveTo(x + r, y)\n\t\t\t\t// 画一条线 x终点、y终点\n\t\t\t\tctx.lineTo(x + w - r, y)\n\t\t\t\t// 绘制右上角圆弧\n\t\t\t\tctx.arc(x + w - r, y + r, r, Math.PI * 1.5, Math.PI * 2)\n\t\t\t\t// 绘制border-right\n\t\t\t\tctx.lineTo(x + w, y + h - r)\n\t\t\t\t// 绘制右下角圆弧\n\n\t\t\t\tctx.arc(x + w - r, y + h - r, r, 0, Math.PI * 0.5)\n\n\t\t\t\t// 绘制左下角圆弧\n\n\t\t\t\tctx.arc(x + r, y + h - r, r, Math.PI * 0.5, Math.PI)\n\n\t\t\t\t// 绘制border-left\n\t\t\t\tctx.lineTo(x, y + r)\n\t\t\t\tif (btn == 'btn') {\n\t\t\t\t\tconst grd = ctx.createLinearGradient(0, 0, 200, 0) //渐变色\n\t\t\t\t\tgrd.addColorStop(0, fillColor)\n\t\t\t\t\tgrd.addColorStop(1, strokeColor)\n\t\t\t\t\t// 因为边缘描边存在锯齿，最好指定使用 transparent 填充\n\t\t\t\t\tctx.setFillStyle(grd)\n\t\t\t\t\t// 对绘画区域填充\n\t\t\t\t\tctx.fill()\n\t\t\t\t} else {\n\n\t\t\t\t\tif (fillColor) {\n\t\t\t\t\t\t// 因为边缘描边存在锯齿，最好指定使用 transparent 填充\n\t\t\t\t\t\tctx.setFillStyle(fillColor)\n\t\t\t\t\t\t// 对绘画区域填充\n\t\t\t\t\t\tctx.fill()\n\t\t\t\t\t}\n\t\t\t\t\tif (strokeColor) {\n\t\t\t\t\t\t// 因为边缘描边存在锯齿，最好指定使用 transparent 填充\n\t\t\t\t\t\tctx.setStrokeStyle(strokeColor)\n\t\t\t\t\t\t// 画出当前路径的边框\n\t\t\t\t\t\tctx.stroke()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// 关闭一个路径\n\t\t\t\tctx.closePath()\n\t\t\t\t// 剪切，剪切之后的绘画绘制剪切区域内进行，需要save与restore 这个很重要 不然没办法保存\n\t\t\t\tctx.clip()\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * canvas绘图相关，把文字转化成只能行数，多余显示省略号\n\t\t\t * ctx: 当前的canvas\n\t\t\t * text: 文本\n\t\t\t * contentWidth: 文本最大宽度\n\t\t\t * lineNumber: 显示几行\n\t\t\t */\n\t\t\tcanvasMultiLineText(ctx, text, contentWidth, lineNumber) {\n\t\t\t\tvar textArray = text.split(\"\"); // 分割成字符串数组\n\t\t\t\tvar temp = \"\";\n\t\t\t\tvar row = [];\n\t\t\t\tfor (let i = 0; i < textArray.length; i++) {\n\t\t\t\t\tif (ctx.measureText(temp).width < contentWidth) {\n\t\t\t\t\t\ttemp += textArray[i];\n\t\t\t\t\t} else {\n\t\t\t\t\t\ti--; // 这里添加i--是为了防止字符丢失\n\t\t\t\t\t\trow.push(temp);\n\t\t\t\t\t\ttemp = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trow.push(temp);\n\n\t\t\t\t// 如果数组长度大于2，则截取前两个\n\t\t\t\tif (row.length > lineNumber) {\n\t\t\t\t\tvar rowCut = row.slice(0, lineNumber);\n\t\t\t\t\tvar rowPart = rowCut[1];\n\t\t\t\t\tvar test = \"\";\n\t\t\t\t\tvar empty = [];\n\t\t\t\t\tfor (var a = 0; a < rowPart.length; a++) {\n\t\t\t\t\t\tif (ctx.measureText(test).width < contentWidth) {\n\t\t\t\t\t\t\ttest += rowPart[a];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tempty.push(test); // 处理后面加省略号\n\t\t\t\t\tvar group = empty[0] + '...'\n\t\t\t\t\trowCut.splice(lineNumber - 1, 1, group);\n\t\t\t\t\trow = rowCut;\n\t\t\t\t}\n\t\t\t\treturn row;\n\t\t\t},\n\t\t\t// 获取海报的小程序码\n\t\t\tcodeImg() {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\trequest({\n\t\t\t\t\t\tmethod: 'get',\n\t\t\t\t\t\turl: '/spSupport/getwxacodeunlimit',\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tversion: this.$parent.globalData.version,\n\t\t\t\t\t\t\tscene: `sku=${this.sku}`,\n\t\t\t\t\t\t\tpage: \"pages/product/detail\",\n\t\t\t\t\t\t\twidth: \"128px\",\n\t\t\t\t\t\t},\n\t\t\t\t\t}).then((res) => {\n\t\t\t\t\t\tif (res.data.code == 0) {\n\t\t\t\t\t\t\tconst fsm = wx.getFileSystemManager();\n\t\t\t\t\t\t\tconst FILE_BASE_NAME = 'tmp_img_src';\n\t\t\t\t\t\t\tlet filePath = `${wx.env.USER_DATA_PATH}/${FILE_BASE_NAME}.jpg`;\n\t\t\t\t\t\t\tfsm.writeFile({\n\t\t\t\t\t\t\t\tfilePath,\n\t\t\t\t\t\t\t\tdata: res.data.data,\n\t\t\t\t\t\t\t\tencoding: 'binary',\n\t\t\t\t\t\t\t\tsuccess() {\n\t\t\t\t\t\t\t\t\tresolve(filePath)\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfail() {\n\t\t\t\t\t\t\t\t\tthis.canvasFlag = true;\n\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\ttitle: '海报生成失败',\n\t\t\t\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: res.data.message,\n\t\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\tthis.canvasFlag = true;\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '海报生成失败',\n\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\n\t\t\t// 生成海报\n\t\t\tcreateCanvasImage() {\n\t\t\t\tconsole.log(this.posterObj, 'posterObj')\n\t\t\t\t// this.canvasFlag=false;\n\t\t\t\t// this.deliveryFlag = false;//关闭分享的弹窗\n\t\t\t\tconsole.log(\"海报生成中\")\n\t\t\t\twx.showLoading({\n\t\t\t\t\ttitle: '海报生成中...'\n\t\t\t\t})\n\t\t\t\tlet _this = this;\n\t\t\t\tlet phoneData = wx.getSystemInfoSync();\n\t\t\t\tthis.phoneH = phoneData.windowHeight-150;\n\t\t\t\tthis.phoneW = phoneData.windowWidth;\n\t\t\t\tlet scaleW = this.phoneW / 375; //按照苹果留 375*667比例 其他型号手机等比例缩放 显示\n\t\t\t\tlet scaleH = this.phoneH / 667; //按照苹果留 375*667比例 其他型号手机等比例缩放 显示\n\t\t\t\tconsole.log(this.phoneH, this.phoneW)\n\t\t\t\tconst ctx = wx.createCanvasContext('myCanvas');\n\t\t\t\tlet url = this.posterObj.url; //商品主图\n\t\t\t\tlet zpPriceIcon = this.posterObj.icon //图标\n\t\t\t\tlet code = this.posterObj.code\n\t\t\t\tlet closeBtn = 'https://imgzuipin.oss-cn-hangzhou.aliyuncs.com/mp_zuipin/poster/close_btn.png'\n\t\t\t\tconsole.log(ctx)\n\t\t\t\tconsole.log(this)\n\n\t\t\t\tctx.draw() //清空原来的画图内容\n\t\t\t\tctx.save();\n\t\t\t\tthis.roundRect(ctx, 50, 100, (this.phoneW - 100), (this.phoneH - 130), 10, '#fff', '#fff'); //绘制海报圆角背景白色的\n\t\t\t\tctx.restore(); //恢复之前保存的绘图上下文 恢复之前保存的绘图上下午即状态 可以继续绘制\n\t\t\t\tctx.save();\n\t\t\t\tthis.roundRect(ctx, 50, 100, (this.phoneW - 100), (370) * scaleH, 10, '#f7f7f7', '#f7f7f7'); //绘制海报圆角背景 上半截灰色的\n\t\t\t\tctx.restore();\n\t\t\t\t//将网络图片转成本地路径 商品图片\n\t\t\t\twx.getImageInfo({\n\t\t\t\t\tsrc: url,\n\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\t//覆盖绘制\n\t\t\t\t\t\t//问题：在微信小程序使用canvas绘制圆角图片时，微信调试工具正常显示，android真机都不显示。\n\t\t\t\t\t\t// 原因：因为ctx.clip()剪切区域使用的填充颜色是透明的，所以图片没出来。\n\t\t\t\t\t\t// 解决方案：将剪切区域设置成实体颜色就好了。\n\t\t\t\t\t\t_this.roundRect(ctx, (_this.phoneW - ((_this.phoneW - 130))) / 2, 120,\n\t\t\t\t\t\t (_this.phoneW - 130),230 * scaleH, 10,\n\t\t\t\t\t\t\t'#f7f7f7', '#f7f7f7') //绘制图片圆角背景\n\t\t\t\t\t\tctx.drawImage(res.path, (_this.phoneW - ((_this.phoneW - 130))) / 2, 120, (_this.phoneW - 130), 230 * scaleH, 10); //绘制图\n\t\t\t\t\t\tctx.restore(); //恢复之前保存的绘图上下文 恢复之前保存的绘图上下午即状态 可以继续绘制\n\t\t\t\t\t\tctx.draw(true)\n\t\t\t\t\t},\n\t\t\t\t\tfail() {\n\t\t\t\t\t\t_this.canvasFlag = true;\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '海报生成失败',\n\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// 关闭按钮\n\t\t\t\twx.getImageInfo({\n\t\t\t\t\tsrc: closeBtn,\n\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\tctx.drawImage(res.path, 50 + (_this.phoneW - 100) + 5, 100, 24, 24)\n\t\t\t\t\t\tctx.draw(true)\n\t\t\t\t\t},\n\t\t\t\t\tfail() {\n\t\t\t\t\t\t_this.canvasFlag = true;\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '海报生成失败',\n\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// 关闭按钮 end\n\t\t\t\t// 海报商品title\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tctx.setGlobalAlpha(1) //不透明\n\t\t\t\t\tctx.setFillStyle('#1c1c1c') //文字颜色：默认黑色\n\t\t\t\t\tctx.setFontSize(14) //设置字体大小，默认10\n\t\t\t\t\tctx.font = 'normal bold 14px sans-serif';\n\t\t\t\t\tlet text = this.posterObj.title;\n\t\t\t\t\tlet row = this.canvasMultiLineText(ctx, text, (this.phoneW - 130), 2); //计算绘制的2行文本\n\t\t\t\t\tlet contentTextY = 360; // 这段文字起始的y位置\n\t\t\t\t\tlet leftSpace = 65; // 这段文字起始的X位置\n\t\t\t\t\tlet textLineHeight = 18; // 一行文字加一行行间距\n\t\t\t\t\tfor (let b = 0; b < row.length; b++) { //一行一行绘制文本\n\t\t\t\t\t\tctx.fillText(row[b], leftSpace, (contentTextY + textLineHeight * b - 15) * scaleH+60, (this.phoneW - 130));\n\t\t\t\t\t\tctx.draw(true)\n\t\t\t\t\t}\n\t\t\t\t}, 500)\n\t\t\t\t// 海报商品title end\n\t\t\t\t// 会员价 图标\n\t\t\t\twx.getImageInfo({\n\t\t\t\t\tsrc: zpPriceIcon,\n\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\tctx.drawImage(res.path, 65, 460 * scaleH, 44, 15)\n\t\t\t\t\t\tctx.draw(true)\n\t\t\t\t\t},\n\t\t\t\t\tfail() {\n\t\t\t\t\t\t_this.canvasFlag = true;\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '海报生成失败',\n\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// 会员价 图标 end\n\t\t\t\t//绘制价格\n\t\t\t\tctx.setFontSize(12) //设置字体大小，默认10\n\t\t\t\tctx.setFillStyle('#c00000') //文字颜色：默认黑色\n\t\t\t\tctx.font = 'normal 12px sans-serif';\n\t\t\t\tctx.fillText('￥', 110, 476 * scaleH, 60);\n\t\t\t\tctx.setFontSize(16) //设置字体大小，默认10\n\t\t\t\tlet zpPrice = this.posterObj.discountPrice; //会员价格\n\t\t\t\tlet orignPrice = this.posterObj.orignPrice; //市场价\n\n\t\t\t\tlet zpPriceW = ctx.measureText(zpPrice).width; //文本的宽度\n\t\t\t\tctx.fillText(zpPrice, 120, 476 * scaleH, zpPriceW);\n\n\t\t\t\tctx.beginPath(); //开始一个新的路径\n\t\t\t\tctx.setFontSize(10) //设置字体大小，默认10\n\t\t\t\tctx.setFillStyle('#999') //文字颜色：默认黑色\n\t\t\t\tlet orignPriceW = ctx.measureText(orignPrice).width //去掉市场价\n\t\t\t\tctx.fillText(`￥${orignPrice}`, 120 + zpPriceW + 5, 475 * scaleH, orignPriceW); //5价格间距\n\t\t\t\tctx.moveTo(120 + zpPriceW + 5, 470 * scaleH); //设置线条的起始路径坐标\n\t\t\t\tctx.lineTo(120 + zpPriceW + 5 + orignPriceW, 470 * scaleH); //设置线条的终点路径坐标\n\t\t\t\tctx.setStrokeStyle('#999')\n\t\t\t\tctx.stroke(); //对当前路径进行描边\n\t\t\t\tctx.closePath(); //关闭当前路径\n\t\t\t\t//绘制价格 end\n\t\t\t\t// this.codeImg().then((res)=>{\n\t\t\t\t// 小程序码\n\t\t\t\twx.getImageInfo({\n\t\t\t\t\tsrc: code,\n\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\tctx.drawImage(res.path, (_this.phoneW - 70) / 2, 490 * scaleH, 70, 70)\n\t\t\t\t\t\tctx.draw(true)\n\t\t\t\t\t},\n\t\t\t\t\tfail() {\n\t\t\t\t\t\t_this.canvasFlag = true;\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '海报生成失败',\n\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// });\n\n\t\t\t\t// 小程序码end\n\t\t\t\t// 小程序的名称\n\t\t\t\tctx.setFontSize(14)\n\t\t\t\tctx.setFillStyle('#2f1709') //文字颜色：默认黑色\n\t\t\t\tctx.font = 'normal bold 14px sans-serif';\n\t\t\t\tctx.fillText('小程序的名称', (_this.phoneW - 90) / 2, 590 * scaleH, 90);\n\t\t\t\t// 小程序的名称end\n\t\t\t\t// 长按/扫描识别查看商品\n\t\t\t\t// ctx.setFontSize(14)\n\t\t\t\t// ctx.setFillStyle('#ff5f33') //文字颜色：默认黑色\n\t\t\t\t// ctx.font = 'normal 14px sans-serif';\n\t\t\t\t// ctx.fillText('长按/扫描识别查看商品', (_this.phoneW - 140) / 2, 550 * scaleH, 140);\n\t\t\t\t// 长按/扫描识别查看商品end\n\t\t\t\t//绘制保存按钮\n\t\t\t\tctx.save();\n\t\t\t\tthis.roundRect(ctx, (this.phoneW - 160) / 2, (this.phoneH - 55)+60, 160, 36, 18, '#ff3600', '#ff6a00', 'btn')\n\t\t\t\tctx.restore();\n\t\t\t\tctx.setFontSize(14)\n\t\t\t\tctx.setFillStyle('#fff') //文字颜色：默认黑色\n\t\t\t\tctx.font = 'normal bold 14px sans-serif';\n\t\t\t\tctx.fillText('保存图片', (_this.phoneW - 58) / 2, (this.phoneH - 33)+60, 58);\n\t\t\t\t//绘制保存按钮 end\n\t\t\t\twx.hideLoading();\n\t\t\t},\n\n\t\t\t// 保存到系统相册\n\t\t\tsaveCanvasImage() {\n\t\t\t\tconsole.log('点击了保存')\n\t\t\t\twx.showLoading({\n\t\t\t\t\ttitle: '保存中...'\n\t\t\t\t})\n\t\t\t\tlet _this = this;\n\t\t\t\t// 1-把画布转化成临时文件\n\t\t\t\tuni.canvasToTempFilePath({\n\t\t\t\t\tx: 50,\n\t\t\t\t\ty: 40,\n\t\t\t\t\twidth: (this.phoneW - 100), // 画布的宽\n\t\t\t\t\theight: (this.phoneH - 120), // 画布的高\n\t\t\t\t\tdestWidth: (this.phoneW - 100) * 5,\n\t\t\t\t\tdestHeight: (this.phoneH - 120) * 5,\n\t\t\t\t\tcanvasId: 'myCanvas',\n\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\t// 2-保存图片至相册\n\t\t\t\t\t\tuni.saveImageToPhotosAlbum({\n\t\t\t\t\t\t\tfilePath: res.tempFilePath,\n\t\t\t\t\t\t\tsuccess(res2) {\n\t\t\t\t\t\t\t\twx.hideLoading();\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: '图片保存成功，可以去分享啦~',\n\t\t\t\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t_this.canvasCancelEvn();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfail() {\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: '保存失败，稍后再试',\n\t\t\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\twx.hideLoading();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\tfail() {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '保存失败，稍后再试',\n\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t\twx.hideLoading();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 取消海报\n\t\t\tcanvasCancelEvn() {\n\t\t\t\tconsole.log('关闭海报')\n\t\t\t\tthis.$emit('cancel', true)\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.content {\n\t\ttext-align: center;\n\t\theight: 100%;\n\t}\n\n\t.canvas_box {\n\t\t.canvas_box_mask {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tright: 0;\n\t\t\tbottom: 0;\n\t\t\tleft: 0;\n\t\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\t\tz-index: 9;\n\t\t}\n\n\t\t.canvas {\n\t\t\tposition: fixed !important;\n\t\t\ttop: 0 !important;\n\t\t\tleft: 0 !important;\n\t\t\tdisplay: block !important;\n\t\t\twidth: 100% !important;\n\t\t\theight: 100% !important;\n\t\t\tz-index: 9;\n\t\t}\n\n\t\t.button-wrapper { \n\t\t\twidth: 320rpx;\n\t\t\theight: 72rpx;\n\t\t\tposition: absolute;\n\t\t\tbottom: 200rpx;\n\t\t\tleft: 215rpx;\n\t\t\tz-index: 16;\n\t\t}\n\n\t\t.save_btn {\n\t\t\tfont-size: 30rpx;\n\t\t\tline-height: 72rpx;\n\t\t\tcolor: #fff;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\ttext-align: center;\n\t\t\tborder-radius: 45rpx;\n\t\t\tborder-radius: 36rpx;\n\t\t\tz-index: 10;\n\t\t}\n\n\t\t.canvas_close_btn { \n\t\t\tposition: fixed;\n\t\t\ttop: 140rpx;\n\t\t\tright: 0;\n\t\t\tz-index: 12;\n\n\t\t}\n\t}\n</style>\n","import mod from \"-!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./hch-poster.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./hch-poster.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1616643980237\n      var cssReload = require(\"C:/Users/huzean/Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}